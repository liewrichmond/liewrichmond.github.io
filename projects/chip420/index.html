<!DOCTYPE html>
<html lang="en" data-theme=""><head>
    <title> Richmond Liew | Chip420 </title>

    
    <meta charset="utf-8"><meta name="generator" content="Hugo 0.74.2" /><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
    <meta name="description" content="I wanna be the very best like no one ever was...">
    
    <link rel="stylesheet"
          href="https://liewrichmond.github.io/css/style.min.1b320c0791722ac0a6fdde1a95f96f83202fa700fec413f074399ec757ac5bed.css"
          integrity="sha256-GzIMB5FyKsCm/d4alflvgyAvpwD&#43;xBPwdDmex1esW&#43;0="
          crossorigin="anonymous"
          type="text/css">
    
    <link rel="stylesheet"
        href="https://liewrichmond.github.io/css/markupHighlight.min.9755453ffb7bc4cd220f86ebb5922107b49f193cc62fc17e9785d27b33a8bf5b.css"
        integrity="sha256-l1VFP/t7xM0iD4brtZIhB7SfGTzGL8F&#43;l4XSezOov1s="
        crossorigin="anonymous"
        type="text/css">
    
    <link rel="stylesheet" 
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" 
    integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" 
    crossorigin="anonymous" />

    
    <link rel="shortcut icon" href="https://liewrichmond.github.io/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="https://liewrichmond.github.io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://liewrichmond.github.io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://liewrichmond.github.io/favicon-16x16.png">

    <link rel="canonical" href="https://liewrichmond.github.io/projects/chip420/">

    
    
    
    
    <script type="text/javascript"
            src="https://liewrichmond.github.io/js/anatole-header.min.d8599ee07b7d3f11bafbac30657ccc591e8d7fd36a9f580cd4c09e24e0e4a971.js"
            integrity="sha256-2Fme4Ht9PxG6&#43;6wwZXzMWR6Nf9Nqn1gM1MCeJODkqXE="
            crossorigin="anonymous"></script>


    
        
        
        <script type="text/javascript"
                src="https://liewrichmond.github.io/js/anatole-theme-switcher.min.e289e9ebb2a4e7a7f895859c8a2b0da2de1ec73f22cea58d8475aa0597023837.js"
                integrity="sha256-4onp67Kk56f4lYWciisNot4exz8izqWNhHWqBZcCODc="
                crossorigin="anonymous"></script>
    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Chip420"/>
<meta name="twitter:description" content="An automation project"/>

</head>
<body><div class="sidebar animated fadeInDown ">
    <div class="logo-title">
        <div class="title">
            <img src="https://liewrichmond.github.io/images/profile.jpg" alt="profile picture">
            <h3 title=""><a href="/">Hi, I&#39;m Richmond</a></h3>
            <div class="description">
                <p>I wanna be the very best like no one ever was...</p>
            </div>
        </div>
    </div>
    <ul class="social-links">
        
            <li>
                <a href="https://www.linkedin.com/in/richmond-liew/" rel="me" aria-label="Linkedin">
                    <i class="fab fa-linkedin fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="https://github.com/liewrichmond" rel="me" aria-label="GitHub">
                    <i class="fab fa-github fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
            <li>
                <a href="mailto:richmond.liew.97@gmail.com" rel="me" aria-label="e-mail">
                    <i class="fas fa-envelope fa-2x" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
    <div class="footer">
        <div class="by_farbox">&copy; Richmond Liew  2021 </div>
    </div>
</div>
<div class="main">
    <div class="page-top  animated fadeInDown ">
    <a role="button" class="navbar-burger" data-target="navMenu" aria-label="menu" aria-expanded="false">
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
    </a>
    <ul class="nav" id="navMenu">
        
        
            
            <li><a 
                   href="/"
                        
                   title="">Projects</a></li>
        
            
            <li><a 
                   href="/about/"
                        
                   title="">About</a></li>
        
        
        
            <li class="theme-switch-item">
                <a class="theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </li>
        
    </ul>
</div>

    <div class="autopagerize_page_element">
        <div class="content">
    <div class="post  animated fadeInDown ">
        <div class="post-content">
            
            <div class="post-title">
                <h3>Chip420</h3>
                
            </div>

            <p>tl;dr: Computer architecture is dope af. <a href="https://github.com/liewrichmond/Chip420">Source</a> | <a href="https://obscure-meadow-66386.herokuapp.com">Demo</a></p>
<h3 id="the-final-product">The Final Product</h3>
<p><img src="/images/chip420.gif" alt="sample"></p>
<h3 id="but-why-tho">But Why tho</h3>
<p>Digital Logic and Design and Computer Architecture were two of my favourite classes while I was at Northeastern(Shoutout to Prof.Tiwari and Prof.Ubal!). What really stuck out to me about those classes is:</p>
<ol>
<li>How complex programming semantics are broken down into tiny instructions</li>
<li>The CPU doesn&rsquo;t really support all that many instructions at all</li>
</ol>
<p>With the fundamentals laid out to me, I decided to try my hand at emulation and really putting my knowledge into practice. I did some digging and found that CHIP-8 was a really good starting to get in to emulation for beginners. I decided to use Typescript + React for this since I really wanted an easy way to distribute and showcase my project and I also thought the contrast of using a language so far abstracted from metal to implement a bare metal component was interesting.</p>
<h3 id="emuwhator">Emuwhator?</h3>
<h3 id="the-code">The Code</h3>
<p>As always, nothing makes me happier than a nice clean project structure. So in order to keep things neat, I decided to hide the main logic in a <code>resources/</code> folder and the rendering React stuff in a <code>components/</code> folder. <code>resources/</code> also kept a bunch of other assets like roms and such.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">src/
|   &gt;components/
|   |someComponent1.tsx
|   |someComponent2.tsx
|   &gt;resources
|       &gt;ts
|       |cpu.ts
|       |graphics.ts
|       &gt;assets/roms
|       |tetris.ch8
|       |spaceInvaders.ch8
</code></pre></div><p>It&rsquo;s also worth mentioning that I kickstarted this project with <code>create-react-app</code>. It&rsquo;s seriously an amazing tool helped me get everything setup quickly and smoothly. Goodbye messing around with config files!</p>
<p>I&rsquo;d also like to preface this by saying that the final code is here has been tweaked many times. I definitely didn&rsquo;t come up with all this in my head from the get-go. I kinda just reorganized things on the fly based on how the project changes.</p>
<h4 id="do-you-have-games-on-your-phone">Do yOu hAvE gAMes oN yoUR pHoNE?</h4>
<p>With the main scaffolding setup, we can finally get to writing some code! The first step that I decided to take with this project was to see if I could first load a rom. Since the emulator is essentially an interpreter for the instructions, loading up an instruction to see what kind of data we&rsquo;re actually dealing with would prove extremely helpful. If we were working on something locally like a Python or C++ application, we could easily do some sort of <code>open(file)</code> equivalent. However, since we&rsquo;re on the web here, we need to use a <code>fetch()</code> in order to get the data.</p>
<p>I still wanted to keep everything neat so I actually wrote file paths as an import.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">    <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Tetris</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../assets/roms/Tetris.ch8&#34;</span>
    <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">spaceInvaders</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../assets/roms/spaceInvaders.ch8&#34;</span>
    <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">testRom</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../assets/roms/test_opcode.ch8&#34;</span>
    <span style="color:#66d9ef">import</span> <span style="color:#a6e22e">testRom2</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#34;../assets/roms/BC_test.ch8&#34;</span>
</code></pre></div><p>This meant that the variable <code>Tetris</code> now referred to the path to the location of the Tetris rom! As such, we&rsquo;re able to use this like so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">    <span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">gameMetadata</span> {
        <span style="color:#a6e22e">romLocation</span>: <span style="color:#66d9ef">string</span>,
        <span style="color:#a6e22e">keyBindings</span><span style="color:#f92672">:</span> { [<span style="color:#a6e22e">customKey</span>: <span style="color:#66d9ef">string</span>]<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> }
    }

    <span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getGameMetadata</span> <span style="color:#f92672">=</span> ()<span style="color:#f92672">:</span> { [<span style="color:#a6e22e">key</span>: <span style="color:#66d9ef">string</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">gameMetadata</span> } <span style="color:#f92672">=&gt;</span> {
        <span style="color:#66d9ef">return</span> ({
            <span style="color:#e6db74">&#34;Tetris&#34;</span><span style="color:#f92672">:</span> {
                <span style="color:#a6e22e">romLocation</span>: <span style="color:#66d9ef">Tetris</span>,
                <span style="color:#a6e22e">keyBindings</span><span style="color:#f92672">:</span> {
                    <span style="color:#75715e">//For later...
</span><span style="color:#75715e"></span>                }
            },
            <span style="color:#75715e">//Other games
</span></code></pre></div><p>With a little extra helper code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">async</span> <span style="color:#a6e22e">getRom</span>(<span style="color:#a6e22e">romStr</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#a6e22e">Promise</span>&lt;<span style="color:#f92672">Uint8Array</span>&gt; {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">response</span>: <span style="color:#66d9ef">Response</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">await</span> <span style="color:#a6e22e">fetch</span>(<span style="color:#a6e22e">romStr</span>);
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">body</span>) {
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">reader</span>: <span style="color:#66d9ef">ReadableStreamReader</span>&lt;<span style="color:#f92672">Uint8Array</span>&gt; <span style="color:#f92672">=</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">body</span>.<span style="color:#a6e22e">getReader</span>();
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">data</span>: <span style="color:#66d9ef">ReadableStreamReadResult</span>&lt;<span style="color:#f92672">Uint8Array</span>&gt; <span style="color:#f92672">=</span> <span style="color:#a6e22e">await</span> <span style="color:#a6e22e">reader</span>.<span style="color:#a6e22e">read</span>();
            <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">value</span>) {
                <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">rawRom</span>: <span style="color:#66d9ef">Uint8Array</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">value</span>;
                <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">rawRom</span>;
            }
            <span style="color:#66d9ef">else</span> {
                <span style="color:#66d9ef">throw</span> (<span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Corrupted ROM data&#34;</span>))
            }
        }
        <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">throw</span> (<span style="color:#66d9ef">new</span> Error(<span style="color:#e6db74">&#34;Could Not Fetch ROM&#34;</span>))
        }
    }
</code></pre></div><p>We can now call it in a nice clean fashion!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">    <span style="color:#a6e22e">await</span> <span style="color:#a6e22e">getRom</span>(<span style="color:#a6e22e">game</span>.<span style="color:#a6e22e">romLocation</span>)
</code></pre></div><p>With some <code>console.log</code> statements, you could actually see the raw rom data in the console!</p>
<p>Of course, <code>.ch8</code> isn&rsquo;t a valid file extension in the eyes of the Typescript compiler. So I actually had to create a little <code>env.d.ts</code> that declares <code>.ch8</code> files as an module</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">    <span style="color:#75715e">/// &lt;reference types=&#34;react-scripts&#34; /&gt;
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">declare</span> <span style="color:#a6e22e">module</span> <span style="color:#e6db74">&#34;*.ch8&#34;</span>
</code></pre></div><h4 id="thanks-mrvon-neumann">Thanks, Mr.von Neumann</h4>
<p>Almost all modern day computers are based off of the von Neumann architecture. This computer architecture proposed that we have a main control unit and Arithmetic Logic Unit aka the CPU, talking to some memory that holds some temporary information. The CHIP8 is no different. Thus, our CHIP8 class looks like</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Chip8</span> {
        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">cpu</span>: <span style="color:#66d9ef">CPU</span>
        <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">memory</span>: <span style="color:#66d9ef">Uint8Array</span>;
</code></pre></div><p>The CHIP8 has about 4KB of memory (4096 bytes) but not all of it us accessible by programs. The first 512 bytes were initially reserved for the interpreter so anything after that would be program addressable memory. In our case, since, we don&rsquo;t need to store the interpreter in memory, not all of the 512 bytes would be used. The one thing that we do need to store in there, however, are some built in sprites. The CHIP8 had some default sprites/fonts stored in there and in case it was referenced somewhere, we wanted to make sure that it was there. I&rsquo;m not going to go into too much detail about the sprites, but you can read about it <a href="">here</a>.</p>
<p>I wanted to ensure that the memory was in a known state upon initialization, so in the <code>Chip8</code> constructor</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Chip8</span> {
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">cpu</span>: <span style="color:#66d9ef">CPU</span>
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">memory</span>: <span style="color:#66d9ef">Uint8Array</span>;
    <span style="color:#75715e">//other fields
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">loadFontsIntoMemory() {</span>
        <span style="color:#75715e">//Load default Hex fonts into memory
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fonts</span>: <span style="color:#66d9ef">number</span>[] <span style="color:#f92672">=</span> [
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0x20</span>, <span style="color:#ae81ff">0x60</span>, <span style="color:#ae81ff">0x20</span>, <span style="color:#ae81ff">0x20</span>, <span style="color:#ae81ff">0x70</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0x10</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0x20</span>, <span style="color:#ae81ff">0x40</span>, <span style="color:#ae81ff">0x40</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x10</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0x90</span>,
            <span style="color:#ae81ff">0xE0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xE0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xE0</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0xE0</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0x90</span>, <span style="color:#ae81ff">0xE0</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xF0</span>,
            <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0xF0</span>, <span style="color:#ae81ff">0x80</span>, <span style="color:#ae81ff">0x80</span>,
        ]
        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">fonts</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">memory</span>[<span style="color:#a6e22e">i</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">fonts</span>[<span style="color:#a6e22e">i</span>]
        }
    }
    
    <span style="color:#66d9ef">constructor</span>() {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">memory</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint8Array</span>(<span style="color:#ae81ff">4096</span>)
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">loadFontsIntoMemory</span>();
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cpu</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">CPU</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">memory</span>);
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyboard</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">createDefaultKeyboard</span>()
    }
</code></pre></div><p>You&rsquo;ll notice that the <code>CPU</code> class also takes the memory as an argument for its constructor. This is done because we&rsquo;d need to read and write to it during operations but also because I didn&rsquo;t really see loading a ROM as a &ldquo;job&rdquo; for the CPU. It does kinda skeeve me out that no one object owns the memory completely, but unless I wanted to write keyboard inputs and IO into the CPU class, I didn&rsquo;t really see a way to do it.</p>
<h4 id="the-cpu">The CPU</h4>
<p>The CPU has a couple of moving parts to it so I&rsquo;mma break it down here</p>
<h4 id="registers">Registers</h4>
<p>On top of memory, a processor also has some the ability to remember small bits of information temporarily by way of <code>registers</code>. Since a register lives within the CPU, it runs on the internal clock speed of it and allows for very quick reads and writes. The CHIP8 has 16 registers and an extra one called the <code>index register</code>. The index reg is typically used as temporary storage for arithmetic operations. For instance, if we&rsquo;d want to calculate the address of a memory offset, the calculation would look like <code>memory address + offset</code>. But now if we need to access this bit of memory, we&rsquo;d already forget it by the next cycle! Therefore, we&rsquo;d store this into the index reg and load up that memory in the next cycle.</p>
<p>In terms of implementation we&rsquo;re just gonna use an array to represent the registers. It stores some data and gives us the ability to access them by index.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CPU</span> {
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">regs</span>: <span style="color:#66d9ef">Uint8Array</span>;
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">indexReg</span>: <span style="color:#66d9ef">number</span>;
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">pc</span>: <span style="color:#66d9ef">number</span>;
    <span style="color:#75715e">//other fields...
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">memory</span>: <span style="color:#66d9ef">Uint8Array</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">regs</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint8Array</span>(<span style="color:#ae81ff">16</span>);
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">indexReg</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        <span style="color:#75715e">/*Our adressable memory space starts at 0x200 cause
</span><span style="color:#75715e">        the first 512 bytes are allegedly being used by the interpreter.*/</span>
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pc</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x200</span>
        <span style="color:#75715e">//other assignments...
</span></code></pre></div><p>It&rsquo;s kinda weird that we&rsquo;re able to take a specialized high speed bit of memory and just storing some value into OUR computer&rsquo;s memory, but hey that&rsquo;s the beauty of technolgical advancements!</p>
<p>Aside from the &ldquo;storage&rdquo; registers, there&rsquo;s also another specialized register called the <code>program counter</code> or <code>pc</code>. As the name implies, this register basically keeps track of where we are in the program (memory). After fetching an instruction from memory, we need to go to the next instruction, and thus we increment the pc! The question now is &ldquo;By how much?&rdquo;. This depends on the &ldquo;width&rdquo; of our instructions. In the case of CHIP8, an instruction is 2bytes so therefore if we&rsquo;d like to increment the pc after an instruction, we&rsquo;d do <code>pc += 2</code>.</p>
<h4 id="the-stack">The Stack</h4>
<p>Aside from the <code>pc</code>, our cpu also needs to keep track of where we are after we do a particular task. As an example, say we had a function <code>addOne(x:number){ return x+1 }</code>. when we run it, this function will essentially be placed into some region on memory and we&rsquo;d need to adjust our <code>pc</code> to that address. Well, once we&rsquo;re done doing what we have to do in the function, we need to keep track of where we next! Thus, before we jump to the address of <code>addOne</code>, we&rsquo;ll put the next <code>pc</code> value onto the stack.</p>
<p>But now, you must be wondering &ldquo;Papa Richmond, how do we keep track of where we are on the stack?&rdquo;. With a stack pointer, of course! When we add something onto the stack, we increment the stack pointer, and when we&rsquo;re done, we just decrement it!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CPU</span> {
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">regs</span>: <span style="color:#66d9ef">Uint8Array</span>;
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">indexReg</span>: <span style="color:#66d9ef">number</span>;
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">pc</span>: <span style="color:#66d9ef">number</span>;
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">stack</span>: <span style="color:#66d9ef">Uint16Array</span>;
    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">stackPtr</span>: <span style="color:#66d9ef">number</span>;
    <span style="color:#75715e">//other fields
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">memory</span>: <span style="color:#66d9ef">Uint8Array</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">regs</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint8Array</span>(<span style="color:#ae81ff">16</span>);
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">indexReg</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stack</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Uint16Array</span>(<span style="color:#ae81ff">16</span>)
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">stackPtr</span> <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">pc</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0x200</span>
        <span style="color:#75715e">//other stuff
</span><span style="color:#75715e"></span>    }
</code></pre></div><h4 id="instructions">Instructions</h4>
<p>At its core, the CPU is really just a glorified calculator waiting for people to tell it what to do. As such, we need a contract to tell the rest of the world what the CPU is capable of, and what you can ask of it. This is done through an <code>Instruction Set Architecture</code> commonly referred to as an <code>ISA</code>. It just defines some methods that you&rsquo;re allowed to tell the CPU do. CHIP8 has 36 instructions in total. They&rsquo;re pretty straightforward to implement but can get VERY tedious. I won&rsquo;t talk about them here because there&rsquo;s plenty of information out there about the implementations like <a href="">Austin Morlan&rsquo;s blog</a> and <a href="">THE go-to CHIP8 reference</a>.</p>
<h4 id="graphics-and-rendering">Graphics and Rendering</h4>
<p>Before we talk about the actual rendering, let&rsquo;s take a quick look at the draw instruction</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#75715e">// DRW Vx, Vy, nibble
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">_Dxyn</span>(<span style="color:#a6e22e">opcode</span>: <span style="color:#66d9ef">number</span>) {
    <span style="color:#75715e">//Bitmasks to extract relevant information
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">spriteHeight</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0x000F</span> <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">opcode</span>)
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Vx</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0x0F00</span> <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">opcode</span>) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">8</span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">Vy</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0x00F0</span> <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">opcode</span>) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#ae81ff">4</span>

    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">regs</span>[<span style="color:#ae81ff">0xF</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
    
    <span style="color:#75715e">//Drawing Logic
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">row</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">row</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">spriteHeight</span>; <span style="color:#a6e22e">row</span><span style="color:#f92672">++</span>) {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">memoryAddr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">indexReg</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">row</span>;
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">spriteToDraw</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">memory</span>[<span style="color:#a6e22e">memoryAddr</span>];

        <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">col</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">col</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">8</span>; <span style="color:#a6e22e">col</span><span style="color:#f92672">++</span>) {
            <span style="color:#75715e">//account for line wrapping
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">yPos</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">regs</span>[<span style="color:#a6e22e">Vy</span>] <span style="color:#f92672">+</span> <span style="color:#a6e22e">row</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">32</span>
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">xPos</span> <span style="color:#f92672">=</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">regs</span>[<span style="color:#a6e22e">Vx</span>] <span style="color:#f92672">+</span> <span style="color:#a6e22e">col</span>) <span style="color:#f92672">%</span> <span style="color:#ae81ff">64</span>
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">shiftAmount</span>: <span style="color:#66d9ef">number</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">7</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">col</span>
            <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">spritePixel</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">spriteToDraw</span> <span style="color:#f92672">&gt;&gt;</span> <span style="color:#a6e22e">shiftAmount</span>) <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0</span><span style="color:#a6e22e">b1</span>
            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">updateGraphicsAt</span>(<span style="color:#a6e22e">xPos</span>, <span style="color:#a6e22e">yPos</span>, <span style="color:#a6e22e">spritePixel</span>)
        }
    }
}
</code></pre></div><p>At the start, we use some masks to extract the information. Then we start updating the pixels, row by row, column by column. Since the sprites are a default width of 8, we can just hard code it. You&rsquo;ll see that we call <code>updateGraphicsAt()</code> which looks like</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">updateGraphicsAt</span>(<span style="color:#a6e22e">xPos</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">yPos</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">spritePixel</span>: <span style="color:#66d9ef">number</span>) {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">currentPixel</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">graphics</span>[<span style="color:#a6e22e">yPos</span>][<span style="color:#a6e22e">xPos</span>];
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">newPixel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">currentPixel</span> <span style="color:#f92672">^</span> <span style="color:#a6e22e">spritePixel</span>;
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">currentPixel</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">newPixel</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">0</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">regs</span>[<span style="color:#ae81ff">0xF</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
    }
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">graphics</span>[<span style="color:#a6e22e">yPos</span>][<span style="color:#a6e22e">xPos</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">newPixel</span>
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">renderer</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">renderer</span>.<span style="color:#a6e22e">updateGraphicsAt</span>(<span style="color:#a6e22e">xPos</span>, <span style="color:#a6e22e">yPos</span>, <span style="color:#a6e22e">newPixel</span>)
    }
}
</code></pre></div><p>Here, we grab the current pixel and then XOR it with the pixel we&rsquo;re trying to draw. If the pixel was initially 1 and it&rsquo;s now 0, we can mark a collision in our <code>0xF</code> register. The truth table for XOR is:</p>
<table>
<thead>
<tr>
<th align="center">A</th>
<th align="center">B</th>
<th align="center">XOR</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>As you can see, when one bit is 1, the only way the output can be 0 is if the other bit is 1, denoting a collision.</p>
<p>Once, we&rsquo;ve gone through all this, what we pass to the <code>renderer</code> will be exactly what we want to draw at that position so we can apply the changes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Renderer</span> {
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">updateGraphicsAt</span>(<span style="color:#a6e22e">xPos</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">yPos</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">pixel</span>: <span style="color:#66d9ef">number</span>) {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pixel</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>) {
            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">fillStyle</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;#00FF00&#34;</span>
        }
        <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">pixel</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>) {
            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">fillStyle</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;black&#34;</span>
        }
        <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>) {
            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">fillRect</span>(
                <span style="color:#a6e22e">xPos</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>,
                <span style="color:#a6e22e">yPos</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>,
                <span style="color:#ae81ff">10</span>,
                <span style="color:#ae81ff">10</span>
            )
        }
    }
}
</code></pre></div><p>Initially, I tried using Pixi.js to render the graphics but it didn&rsquo;t come out the right way. It&rsquo;s hard to describe exactly, but everything just looked misplaced. Pixels that should have been on were off and vice versa.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts">    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">updateGraphicsAt</span>(<span style="color:#a6e22e">xPos</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">yPos</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">pixel</span>: <span style="color:#66d9ef">number</span>) {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">pixel</span>) {
            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">graphics</span>.<span style="color:#a6e22e">fill</span>.<span style="color:#a6e22e">color</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">0x00FF00</span>) {
                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">graphics</span>.<span style="color:#a6e22e">beginFill</span>(<span style="color:#ae81ff">0x00FF00</span>);
            }
        }
        <span style="color:#66d9ef">else</span> {
            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">graphics</span>.<span style="color:#a6e22e">fill</span>.<span style="color:#a6e22e">color</span> <span style="color:#f92672">!==</span> <span style="color:#ae81ff">0x000000</span>) {
                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">graphics</span>.<span style="color:#a6e22e">beginFill</span>(<span style="color:#ae81ff">0x000000</span>);
            }
        }
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">graphics</span>.<span style="color:#a6e22e">drawRect</span>((<span style="color:#a6e22e">xPos</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>), (<span style="color:#a6e22e">yPos</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>), <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">10</span>);
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">graphics</span>.<span style="color:#a6e22e">endFill</span>()
    }
</code></pre></div><p>I couldn&rsquo;t figure out what happened, but I suspect that I might be trying to change the color a little bit too much&hellip;? Revisting the code, it actually might be worth to try adding another <code>PIXI.graphics</code> and have one dedicated to drawing on pixels and the other to draw off ones. It took a hot minute to figure out that it was just the actual rendering that wasn&rsquo;t working a not any of my rendering logic but I figured it out in the end.</p>
<h4 id="tying-it-all-together">Tying It All Together</h4>
<p>Once I had the main components working, all I had to do was add some I/O and doing the actual game loop.</p>
<p>The key presses are pretty simple.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CPU</span> {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span> <span style="color:#f92672">=</span> {
        <span style="color:#a6e22e">0x0</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0x1</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0x2</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0x3</span>: <span style="color:#66d9ef">false</span>,
        <span style="color:#a6e22e">0x4</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0x5</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0x6</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0x7</span>: <span style="color:#66d9ef">false</span>,
        <span style="color:#a6e22e">0x8</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0x9</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0xA</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0xB</span>: <span style="color:#66d9ef">false</span>,
        <span style="color:#a6e22e">0xC</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0xD</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0xE</span>: <span style="color:#66d9ef">false</span>, <span style="color:#a6e22e">0xF</span>: <span style="color:#66d9ef">false</span>
    }

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">registerKeyPress</span>(<span style="color:#a6e22e">code</span>: <span style="color:#66d9ef">number</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keys</span>[<span style="color:#a6e22e">code</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>
    }
    <span style="color:#75715e">//other stuff
</span><span style="color:#75715e"></span>}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Chip8</span> {
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">registerKeyPress</span>(<span style="color:#a6e22e">code</span>: <span style="color:#66d9ef">string</span>)<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> {
        <span style="color:#66d9ef">if</span> (Object.<span style="color:#a6e22e">keys</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyboard</span>).<span style="color:#a6e22e">includes</span>(<span style="color:#a6e22e">code</span>)) {
            <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cpu</span>.<span style="color:#a6e22e">registerKeyPress</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">keyboard</span>[<span style="color:#a6e22e">code</span>])
        }
    }
    <span style="color:#75715e">//other stuff
</span><span style="color:#75715e"></span>}
</code></pre></div><p>And if you remember, when we fetch a rom, we have custom key bindings</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">gameMetadata</span> {
    <span style="color:#a6e22e">romLocation</span>: <span style="color:#66d9ef">string</span>,
    <span style="color:#a6e22e">keyBindings</span><span style="color:#f92672">:</span> { [<span style="color:#a6e22e">customKey</span>: <span style="color:#66d9ef">string</span>]<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> }
}

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">getGameMetadata</span> <span style="color:#f92672">=</span> ()<span style="color:#f92672">:</span> { [<span style="color:#a6e22e">key</span>: <span style="color:#66d9ef">string</span>]<span style="color:#f92672">:</span> <span style="color:#a6e22e">gameMetadata</span> } <span style="color:#f92672">=&gt;</span> {
    <span style="color:#66d9ef">return</span> ({
        <span style="color:#e6db74">&#34;Tetris&#34;</span><span style="color:#f92672">:</span> {
            <span style="color:#a6e22e">romLocation</span>: <span style="color:#66d9ef">Tetris</span>,
            <span style="color:#a6e22e">keyBindings</span><span style="color:#f92672">:</span> {
                <span style="color:#e6db74">&#34;ArrowLeft&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;w&#34;</span>,
                <span style="color:#e6db74">&#34;ArrowRight&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;e&#34;</span>,
                <span style="color:#e6db74">&#34;ArrowUp&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;q&#34;</span>,
                <span style="color:#e6db74">&#34;ArrowDown&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;a&#34;</span>
            }
        },
        <span style="color:#75715e">//other games
</span></code></pre></div><p>Since it&rsquo;s just a keyboard event, in the <code>.tsx</code> file I could just call it when the event happens</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tsx" data-lang="tsx"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">someComponent</span>: <span style="color:#66d9ef">React.FC</span> <span style="color:#f92672">=</span> () <span style="color:#f92672">=&gt;</span> {
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">registerKeyPress</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">event</span>: <span style="color:#66d9ef">React.KeyboardEvent</span>) <span style="color:#f92672">=&gt;</span> {
        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">chip8</span>.<span style="color:#a6e22e">current</span>) {
            <span style="color:#a6e22e">chip8</span>.<span style="color:#a6e22e">current</span>.<span style="color:#a6e22e">registerKeyPress</span>(<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">key</span>)
        }
    }

    <span style="color:#66d9ef">return</span>(
        &lt;<span style="color:#f92672">someSubComponent</span> <span style="color:#a6e22e">registerKeyPress</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">registerKeyPress</span>} /&gt;
    )
}
</code></pre></div><p>To kickstart the CPU cycles, we just need to call <code>setInterval()</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ts" data-lang="ts"><span style="color:#66d9ef">public</span> <span style="color:#a6e22e">start</span>(<span style="color:#a6e22e">clockSpeed</span>: <span style="color:#66d9ef">number</span>, <span style="color:#a6e22e">newKeyBindings</span><span style="color:#f92672">?:</span>{ [<span style="color:#a6e22e">keyCode</span>: <span style="color:#66d9ef">string</span>]<span style="color:#f92672">:</span> <span style="color:#66d9ef">string</span> } )<span style="color:#f92672">:</span> <span style="color:#66d9ef">void</span> {
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cpu</span>.<span style="color:#a6e22e">reset</span>()
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setKeyboard</span>(<span style="color:#a6e22e">newKeyBindings</span>);
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cycleInterval</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">setInterval</span>(() <span style="color:#f92672">=&gt;</span> { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cpu</span>.<span style="color:#a6e22e">cycle</span>() }, <span style="color:#a6e22e">clockSpeed</span>)
    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">delayInterval</span> <span style="color:#f92672">=</span> window.<span style="color:#a6e22e">setInterval</span>(() <span style="color:#f92672">=&gt;</span> { <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">cpu</span>.<span style="color:#a6e22e">decrementTimer</span>() }, <span style="color:#ae81ff">16</span>)
}
</code></pre></div><h4 id="react">React</h4>
<p>As always, I don&rsquo;t really feel about writing about the React code because I didn&rsquo;t think it was very interesting. It was just kinda standard React stuff that I messed around with to get it looking the way I want it to. One thing that I would like to note is that I used <a href="">React95</a> components because I think it suits the A E S T H E T I C.</p></div>
        <div class="post-footer">
            <div class="info">
                
                <span class="separator"><a class="tag" href="/tags/frontend/">frontend</a><a class="tag" href="/tags/emulation/">emulation</a><a class="tag" href="/tags/typescript/">Typescript</a><a class="tag" href="/tags/react/">React</a></span>

            </div>
        </div>

        
    </div>


        </div>
    </div>
</div>

<script type="text/javascript"
        src="https://liewrichmond.github.io/js/jquery.min.86b1e8f819ee2d9099a783e50b49dff24282545fc40773861f9126b921532e4c.js"
        integrity="sha256-hrHo&#43;BnuLZCZp4PlC0nf8kKCVF/EB3OGH5EmuSFTLkw="
        crossorigin="anonymous"></script>




<script type="text/javascript"
        src="https://liewrichmond.github.io/js/bundle.min.0f9c74cb78f13d1f15f33daff4037c70354f98acfbb97a6f61708966675c3cae.js"
        integrity="sha256-D5x0y3jxPR8V8z2v9AN8cDVPmKz7uXpvYXCJZmdcPK4="
        crossorigin="anonymous"></script>

<script type="text/javascript"
        src="https://liewrichmond.github.io/js/medium-zoom.min.92f21c856129f84aeb719459b3e6ac621a3032fd7b180a18c04e1d12083f8aba.js"
        integrity="sha256-kvIchWEp&#43;ErrcZRZs&#43;asYhowMv17GAoYwE4dEgg/iro="
        crossorigin="anonymous"></script>
</body>

</html>
